<div class="treeview_main">
    <ng-container *ngIf="getSelectedItem() as item">
        <div *ngIf="item.coversheet?.length">
            <p class="section_header">Cover</p>
            <ng-container *ngFor="let sec of item.coversheet">
                <ng-container *ngTemplateOutlet="recursiveTree; context:{ $implicit: sec, level: 1 }"></ng-container>
            </ng-container>
        </div>
        <div *ngIf="item.content?.length">
            <p class="section_header">Content</p>
            <ng-container *ngFor="let sec of item.content">
                <ng-container *ngTemplateOutlet="recursiveTree; context:{ $implicit: sec, level: 1 }"></ng-container>
            </ng-container>
        </div>
        <ng-container *ngIf="item.abbreviations?.length">
            <p class="section_header">Abbreviations:</p>
            <ul>
                <li *ngFor="let ab of item.abbreviations">
                    {{ ab.abbreviation }} = {{ ab.shortDescription }}
                </li>
            </ul>
        </ng-container>
    </ng-container>

    <!-- Rekursives Template fÃ¼r die Baumansicht -->
    <ng-template #recursiveTree let-parent let-section let-level="level">
        <div [ngStyle]="getMarginLeft(level)">
            <span (click)="onSelectTreeItem(section.value)" (dblclick)="onOpenCloseSection(section.value)"
                class="tree_item"
                [ngClass]="{'hasChildren': hasChildren(section), 'tree_item-open': hasChildren(section) && getItemExpanded(section), 'selected': isSelectedSection(section)}"
                (contextmenu)="onOpenBrowserContext($event)">
                <div *ngIf="section.value">{{ section.value }}</div>
                <div *ngIf="!section.value">{{ section.type }}</div>
            </span>
            <!-- <div *ngIf="(section.type && section.type == 'ENUMERATION')">
          <button (click)="createNewItem(parent, i, 'step')" style="margin-left: 4px;">+Step</button>
          <button (click)="deleteItem(parent)" style="margin-left: 4px;">delete</button>
       </div>
       <div *ngIf="(section.type && section.type != 'ENUMERATION')">
          <button (click)="createNewItem(parent, i, 'subsection')" style="margin-left: 4px;">+Subsection</button>
          <button (click)="createNewItem(parent, i, 'content')" style="margin-left: 4px;">+Content</button>
          <button (click)="deleteItem(parent)" style="margin-left: 4px;">delete</button>
       </div>-->
        </div>

        <div *ngIf="getItemExpanded(section)">
            <div *ngIf="section.coversheet?.length">
                <ng-container *ngFor="let sub of section.coversheet; let j = index">
                    <ng-container
                        *ngTemplateOutlet="recursiveTree; context:{ $implicit: sub, level: level + 1, parent: section, index: j }"></ng-container>
                </ng-container>
            </div>

            <div *ngIf="section.content?.length">
                <ng-container *ngFor="let sub of section.content; let j = index">
                    <ng-container
                        *ngTemplateOutlet="recursiveTree; context:{ $implicit: sub, level: level + 1, parent: section, index: j }"></ng-container>
                </ng-container>
            </div>

            <div *ngIf="section.subsections?.length">
                <ng-container *ngFor="let sub of section.subsections; let j = index">
                    <ng-container
                        *ngTemplateOutlet="recursiveTree; context:{ $implicit: sub, level: level + 1, parent: section, index: j }"></ng-container>
                </ng-container>
            </div>

            <div *ngIf="section.steps?.length">
                <ng-container *ngFor="let step of section.steps">
                    <ng-container
                        *ngTemplateOutlet="recursiveTree; context:{ $implicit: step, level: level + 1, parent: section }"></ng-container>
                </ng-container>
            </div>
        </div>
    </ng-template>

</div>